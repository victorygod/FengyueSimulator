<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">增强版聊天机器人</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 id="mainTitle">增强版聊天机器人</h1>
            <div class="controls">
                <button id="apiKeyBtn" class="metro-btn">API密钥</button>
                <button id="promptsBtn" class="metro-btn">提示词</button>
                <button id="savesBtn" class="metro-btn">存档</button>
                <button id="cgManageBtn" class="metro-btn">CG管理</button>
                <div class="memory-control">
                    <label for="memoryRounds">记忆轮数:</label>
                    <input type="number" id="memoryRounds" min="0" max="20" value="6">
                </div>
                <button id="clearChatBtn" class="metro-btn danger">清空聊天</button>
            </div>
        </header>

        <main class="main">
            <div class="chat-container">
                <div id="chatHistory" class="chat-history"></div>
                
                <div class="input-area">
                    <div class="input-row">
                        <input type="text" id="messageInput" placeholder="输入您的消息..." autocomplete="off">
                        <button id="sendBtn" class="metro-btn primary">发送</button>
                    </div>
                    <div class="status-row">
                        <span id="statusText">就绪</span>
                        <span id="promptIndicator">默认提示词</span>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 模态框 -->
    <div id="modalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal-content metro-modal">
            <div class="modal-header">
                <h2 id="modalTitle">模态框标题</h2>
                <button class="close-btn metro-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- 动态内容 -->
            </div>
        </div>
    </div>

    <!-- API密钥管理模态框内容 -->
    <template id="apiKeyTemplate">
        <div class="form-group">
            <label for="apiKeyInput">DeepSeek API密钥:</label>
            <input type="password" id="apiKeyInput" placeholder="输入您的API密钥" class="metro-input">
        </div>
        <div class="form-group">
            <button id="saveApiKey" class="metro-btn primary">保存密钥</button>
            <button id="toggleApiKeyVisibility" class="metro-btn secondary">显示/隐藏</button>
        </div>
        <div class="status-info metro-status">
            <p>状态: <span id="apiKeyStatus">未设置</span></p>
            <p class="file-info">配置文件: api_key.json</p>
        </div>
    </template>

    <!-- 提示词管理模态框内容 -->
    <template id="promptsTemplate">
        <div class="form-group">
            <label>当前提示词:</label>
            <select id="promptSelect" class="metro-input">
                <option value="">加载中...</option>
            </select>
        </div>
        <div class="form-group">
            <label for="promptJsonEditor">提示词配置JSON:</label>
            <textarea id="promptJsonEditor" placeholder="请输入完整的提示词配置JSON..." class="metro-input code-editor"></textarea>
        </div>
        <div class="form-group">
            <input type="text" id="newPromptName" placeholder="新提示词文件名 (如: 我的提示词.json)" class="metro-input">
            <div class="button-group">
                <button id="savePrompt" class="metro-btn primary">保存修改</button>
                <button id="newPrompt" class="metro-btn secondary">新建文件</button>
                <button id="renamePrompt" class="metro-btn secondary">重命名当前</button>
                <button id="deletePrompt" class="metro-btn danger">删除当前</button>
            </div>
        </div>
        <div class="file-info metro-status">
            <p>提示词文件存储在 prompts/ 目录下，格式为 .json 文件</p>
        </div>
    </template>

    <!-- 存档管理模态框内容 -->
    <template id="savesTemplate">
        <div class="form-group">
            <label>存档列表:</label>
            <select id="savesSelect" size="10" class="metro-input">
                <option value="">加载中...</option>
            </select>
        </div>
        <div class="form-group">
            <input type="text" id="newSaveName" placeholder="新存档文件名 (如: 我的存档.json)" class="metro-input">
            <div class="button-group">
                <button id="saveChat" class="metro-btn primary">保存聊天</button>
                <button id="loadChat" class="metro-btn secondary">加载选中</button>
                <button id="renameSave" class="metro-btn secondary">重命名选中</button>
                <button id="deleteSave" class="metro-btn danger">删除选中</button>
            </div>
        </div>
        <div class="file-info metro-status">
            <p>存档文件存储在 save/ 目录下，格式为 .json 文件</p>
        </div>
    </template>

    <!-- CG管理模态框内容 -->
    <template id="cgTemplate">
        <div class="cg-container">
            <div class="cg-main">
                <div class="cg-list-section">
                    <label>CG文件列表:</label>
                    <select id="cgSelect" size="12" class="cg-list metro-input">
                        <option value="">加载中...</option>
                    </select>
                    <div class="cg-actions">
                        <input type="text" id="newCGName" placeholder="新CG文件名" class="metro-input">
                        <div class="action-buttons">
                            <button id="renameCG" class="metro-btn secondary">重命名</button>
                            <button id="deleteCG" class="metro-btn danger">删除</button>
                        </div>
                    </div>
                </div>
                
                <div class="preview-section">
                    <label>CG预览:</label>
                    <div class="preview-area metro-preview">
                        <img id="cgPreview" class="resource-preview" style="display: none;">
                        <div class="preview-placeholder" id="previewPlaceholder">
                            <span>选择文件预览</span>
                            <p>支持的格式: JPG, PNG, GIF, BMP</p>
                        </div>
                    </div>
                    <div class="upload-section">
                        <input type="file" id="fileUpload" accept="image/*" style="display: none;">
                        <button id="copyToCG" class="metro-btn primary">复制文件到CG目录</button>
                    </div>
                </div>
            </div>
            
            <div class="cg-footer metro-status">
                <p>说明: 当AI回复中包含CG文件名时，会自动显示对应的图片</p>
                <p class="file-info">CG文件存储在 resource/ 目录下</p>
            </div>
        </div>
    </template>

    <script src="app.js"></script>
</body>
</html>